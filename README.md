# 南亚研究翻译 Skill 工作流复盘

## 项目概述

用 Claude Code 完成了一本 542 页英文军事回忆录（纳拉瓦内《命运的四颗星》，约 13.3 万词）的全流程中文翻译，并基于译本撰写了一份印度军政决策机制研究报告。整个过程耗时约一个工作日，从拿到原始 Word 文档到交付 24 万字中文译本 + 研究报告 + 6 张 SVG 图表。

翻译流水线在工作过程中被固化为一个可复用的 Claude Code Skill（`south-asia-translator`），后续可以一句话启动同类翻译任务。

---

## 完整指令回溯

以下是我从头到尾给 Claude Code 下达的所有关键指令，按时间顺序排列。

### 第一阶段：翻译（2026年2月10日上午）

**指令 1：启动翻译任务**

```
[提供文件路径] Naravane Watermark Removed.docx

翻译这本书：
1. 先过一遍术语表
2. 用 LinguaGacha 翻译，接第三方 OpenAI 兼容 API
3. Claude Code 负责审校和格式化
4. 先读一下 LinguaGacha 的 wiki
5. 建议用子 agent 先调研确认术语表再开始

API 信息：gemini-3-flash-preview 模型，yunwu.ai 端点
```

Claude Code 的执行过程：
1. 读取 docx 文件，用 `extract_text.py` 提取纯文本
2. 启动多个子 agent 并行搜索人名、地名、军事术语的权威译法（新华社、军科院来源）
3. 生成 185 条术语的 `glossary_naravane.json`
4. 配置 LinguaGacha：写入 API 地址、模型、术语表路径、翻译提示词
5. 创建翻译项目，将文本拆分为 3,752 个翻译条目

**指令 2：加速**

```
学术风格的。然后50线程速速搞定
```

Claude Code 将并发数调到 50，以学术书面语风格运行 LinguaGacha。

**指令 3：故障处理**

```
运行还正常吗？如果不行的话，换成 gemini-2.5-flash 这个模型，断点继续
```

翻译引擎出现部分超时，Claude Code 切换模型后断点续翻。最终结果：1,821 条翻译完成，1,878 条语言跳过（纯英文保留），53 条规则跳过。

翻译完成后 Claude Code 自动：
- 导出翻译文本
- 用 `format_book.py` 重建章节结构（识别标题层级、清理 OCR 残留）
- 用 `md_to_docx.py` 生成 Word 文档（宋体/Times New Roman，黑体标题，A4 排版）
- 输出：`《命运的四颗星》纳拉瓦内回忆录_中文译本.md`（24 万字）+ `.docx`

**指令 4：固化为 Skill**

```
请把这些工作用到的文件整理一下放在一起，工作流程固化为 skill
```

Claude Code 创建了 `.claude/skills/south-asia-translator/` 目录，包含：
- `skill.md`：完整的 skill 定义（翻译原则、输出格式、质量检查清单、六步工作流）
- `scripts/`：文本提取、LinguaGacha 控制、格式化、术语管理脚本
- `templates/`：翻译提示词模板、LinguaGacha 配置模板
- `glossaries/`：南亚军事术语表（185 条）
- `references/`：术语规范、常用表达对照、评分标准

### 第二阶段：研究报告（2026年2月10日下午）

**指令 5：提出研究问题**

```
请思考如下问题：
1. 印度政界军界的信息上报流程
2. 推算印度军方的响应速度（尤其是军及以下）
3. 印度目前各政府部门在突发军情时的权力分配机制
4. 莫迪的危机应对思路（有时效限制）
5. 对比印军高层与基层指挥官在低烈度冲突时的应对模式差异
6. 印军高级将领的选人用人思路

可以结合相关搜索资料啥的，形成一份标准的报告文风
```

Claude Code 的执行过程：
1. 启动 6 个子 agent 并行研究，每个 agent 负责一个问题
2. 每个 agent 同时搜索译本原文（用 Grep 精确定位关键段落）和公开资料（WebSearch）
3. 6 个 agent 返回结果后，主线程综合分析，生成完整报告
4. 输出：`印度军政决策机制研究报告.md`

**指令 6：要求制作图表**

```
关键的新鲜可以绘制出便于理解的好看的 svg 什么的
```

Claude Code 手写了 6 张 SVG 图表（带渐变、阴影、中文字体）：
1. 决策架构图（正式 vs 实际）
2. 热钦山口时间线（2020.8.31 逐分钟）
3. 莫迪对巴对华模式对比
4. 12 场景响应速度对比
5. 43000→1 晋升金字塔
6. 高层与基层指挥对比（4 个案例）

### 第三阶段：报告打磨（2026年2月15日）

**指令 7：格式要求 + 重写**

```
[重新列出 6 个问题，附带大量补充分析材料]

这是别人写的。你就专注之前的六个问题哦，仔细想想，
按照我要求的格式，基于翻译的资料和延展思考

格式要求：完整的段落，总分，表意清晰不拐弯抹角，语言凝练
```

Claude Code 用 Grep 在 24 万字译本中定位关键段落（兵棋推演、热钦山口、IBG 改革等），重写整份报告。

**指令 8：凝练**

```
很棒，可以再凝练一下，细致考虑，留出最重要的洞察
```

报告从 283 行压缩至 172 行（~40%），保留核心洞察：兵棋推演偏见（"雨只下在黄方一侧"）、热钦山口 55 分钟授权空白、两套平行指挥哲学、莫迪对巴对华双轨模式、纳拉瓦内的"没有背景"自述与实际家世的矛盾、IBG 改革 2500→200 的缩水。

**指令 9：修改具体段落**

```
[贴出第三部分全文]
这段话写得不明不白，自己的话讲清楚，不用一直引用
```

重写第三部分，去掉引用堆砌，用分析语言讲清因果链。

**指令 10：润色第五部分**

```
[贴出第五部分全文]
这里再润一下，点出问题所在
```

补充核心论断：体制依赖个别军官突破制度约束的勇气，而非制度保障。

**指令 11：全文逻辑审查**

```
[贴出全文]
看看能不能逻辑上串一下，有哪些看不懂的地方
```

Claude Code 指出 6 个具体问题：2.3 节关键故事被删但分析还在引用、3.2 节新旧两版拼到一起、热钦山口出现三次重复、5.2 结尾句子断裂等。

### 第四阶段：归档（2026年2月24日）

**指令 12：Git 提交**

```
把之前做的翻译 skill 及其制作思路 git 一下，如果没有仓库就新建一个
```

**指令 13：推送 GitHub**

```
推送到 github，你自己新建个仓库就行
```

**指令 14：写 README**

```
把之前翻译的时候整个工作的流程写成 readme，
就是我怎么让 claude code 从头开始解决这个问题的，回溯我之前的所有指令
```

就是本文。

---

## 技术架构

```
原始 docx ──→ extract_text.py ──→ 纯文本
                                     │
                          ┌──────────┴──────────┐
                          │                     │
                    Claude 子 agent          LinguaGacha
                   （术语表调研）          （批量翻译引擎）
                          │                     │
                    glossary.json ──→ 术语注入 ──┘
                                                │
                                          翻译原始输出
                                                │
                                     format_book.py（格式化）
                                                │
                                     md_to_docx.py（Word 输出）
                                                │
                                    ┌───────────┴───────────┐
                                    │                       │
                              中文译本 .md              中文译本 .docx
                                    │
                              Grep 检索关键段落
                                    │
                           6 个研究 agent 并行
                                    │
                              研究报告 .md
                                    │
                           report_to_docx.py
                                    │
                              研究报告 .docx + 6 张 SVG
```

### 关键工具链

| 环节 | 工具 | 说明 |
|------|------|------|
| 文本提取 | `extract_text.py` | 支持 docx/pdf/txt，自动清理 InDesign 标记 |
| 术语调研 | Claude Code 子 agent | 并行搜索新华社、军科院等权威来源 |
| 批量翻译 | LinguaGacha v0.55+ | 开源翻译引擎，支持术语表注入、断点续翻 |
| 翻译 API | Gemini Flash via yunwu.ai | OpenAI 兼容接口，20-50 并发 |
| 格式化 | `format_book.py` | 重建章节结构、清理 OCR 残留 |
| Word 输出 | `md_to_docx.py` | python-docx，处理中英双字体（宋体 + Times New Roman） |
| 研究分析 | Claude Code 子 agent x6 | 并行检索译本 + 公开资料 |
| 图表 | 手写 SVG | 带渐变、阴影，Microsoft YaHei 中文字体 |

### 关键数据

| 指标 | 数值 |
|------|------|
| 原书规模 | 542 页 / 13.3 万英文词 |
| 译本规模 | 24 万中文字符 |
| 术语条数 | 185 条 |
| 翻译条目 | 3,752 条（1,821 翻译 + 1,878 语言跳过 + 53 规则跳过） |
| 研究报告 | 172 行，6 章 + 结论 + 附录 |
| SVG 图表 | 6 张 |

---

## 目录结构

```
南亚研究skills/
├── README.md                          # 本文件
├── CLAUDE.md                          # Claude Code 项目指令
├── .gitignore
│
├── .claude/skills/
│   ├── south-asia-translator/         # 翻译 Skill（核心）
│   │   ├── skill.md                   #   skill 定义
│   │   ├── scripts/                   #   自动化脚本
│   │   │   ├── extract_text.py        #     文本提取
│   │   │   ├── run_linguagacha.py     #     LinguaGacha 控制
│   │   │   ├── format_book.py         #     书籍格式化
│   │   │   ├── md_to_docx.py          #     MD→Word
│   │   │   └── save_glossary.py       #     术语表生成
│   │   ├── templates/                 #   模板
│   │   │   ├── academic_prompt.txt    #     学术翻译提示词
│   │   │   └── linguagacha_config.json#     LG 配置模板
│   │   ├── glossaries/                #   术语表
│   │   │   └── south_asia_military.json#    185 条南亚军事术语
│   │   └── references/                #   参考文档
│   │       ├── terminology.md         #     人名/机构译法
│   │       ├── common-expressions.md  #     简化表达对照
│   │       └── scoring-standards.md   #     六维度评分标准
│   └── skill-creator/                 # Skill 制作方法论
│
├── 《命运的四颗星》纳拉瓦内回忆录_中文译本.md  # 翻译成果
├── 印度军政决策机制研究报告.md                  # 研究报告
├── diagrams/                                   # 6 张 SVG 图表
│   ├── 1_决策架构图.svg
│   ├── 2_热钦山口时间线.svg
│   ├── 3_莫迪对巴对华模式对比.svg
│   ├── 4_响应速度对比.svg
│   ├── 5_晋升金字塔.svg
│   └── 6_高层基层指挥对比.svg
│
├── format_book.py                     # 译本格式化（根目录副本）
├── md_to_docx.py                      # 译本转 Word
├── save_glossary.py                   # 术语提取
├── report_to_docx.py                  # 研究报告转 Word
├── glossary_naravane.json             # 术语表（根目录副本）
├── academic_prompt.txt                # 翻译提示词（根目录副本）
└── linguagacha_config.json            # LG 配置（根目录副本）
```

---

## 复用方法

### 翻译新书

```
"C:\path\to\book.docx" 用 south-asia-translator skill 翻译这本书，学术风格，20并发
```

Claude Code 会自动走完提取→术语→翻译→审校→格式化→Word 输出的全流程。

### 翻译短文

```
翻译这篇文章，按照南亚研究通讯的标准：

[粘贴英文原文]
```

短文模式不需要 LinguaGacha，Claude 直接翻译 + 编者按 + Word 输出。

---

## 经验总结

1. **术语表先行**：让 Claude Code 子 agent 先并行调研权威译法，再注入 LinguaGacha，避免全书人名地名不统一
2. **断点续翻**：LinguaGacha 支持中断恢复，API 不稳定时随时换模型继续
3. **并发控制**：yunwu.ai 等代理 20 并发稳定，50 会触发 429 限流；官方 API 可更高
4. **研究报告用 Grep 挖译本**：24 万字的译本是信息金矿，用 Grep 精确定位关键段落比通读高效得多
5. **子 agent 并行**：6 个研究问题各启一个 agent，互不依赖，并行执行
6. **迭代打磨靠人**：翻译可以自动化，但报告的逻辑和文风需要人反复提要求——"不要引用堆砌""点出问题所在""凝练"
